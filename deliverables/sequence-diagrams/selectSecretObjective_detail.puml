@startuml

!startsub PARTS
!include events.puml

!procedure $selectObjective_req($client, $server=Server)
    $client -> $server: selectObjective(objective)
!endprocedure

!procedure $selectObjective_res_OK($client, $server=Server)
    $client <-- $server: OK
!endprocedure

!procedure $selectObjective_res_KO_doubleChoice($client, $server=Server)
    $client <-- $server: KO, doubleChoice()
!endprocedure

!procedure $selectObjective_res_KO_invalidObjective($client, $server=Server)
    $client <-- $server: KO, invalidObjective()
!endprocedure

!procedure $selectObjective_seq($client, $inGame="", $server=Server)
    $selectObjective_req($client)
    $selectObjective_res_OK($client)

    !foreach $other in %splitstr($inGame, "~")
        $event_updateChosenObjectiveList($other)
    !endfor
!endprocedure

!endsub

title Select secret objective
participant Alice
participant Server
participant Bob

hnote over Alice : IN_GAME
/ hnote over Bob : IN_GAME

$event_updateGameStatus(SETUP_OBJECTIVE, NULL, Alice)
$event_setSecretObjectives(Alice)
$event_updateGameStatus(SETUP_OBJECTIVE, NULL, Bob)
$event_setSecretObjectives(Bob)

|||

$selectObjective_req(Alice)
alt 
    $selectObjective_res_OK(Alice)
    $event_updateChosenObjectiveList(Alice)
    $event_updateChosenObjectiveList(Bob)
else player has already chosen
    $selectObjective_res_KO_doubleChoice(Alice)
else invalid objective
    $selectObjective_res_KO_invalidObjective(Alice)
end

@enduml
