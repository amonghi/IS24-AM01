@startuml

!startsub PARTS
!include events.puml

!procedure $selectColor_req($client, $server=Server)
    $client -> $server: selectColor(color)
!endprocedure

!procedure $selectColor_res_OK_contended($client, $server=Server)
    $client <-- $server: OK, contended()
!endprocedure

!procedure $selectColor_res_OK_notContended($client, $server=Server)
    $client <-- $server: OK, notContended()
!endprocedure

!procedure $selectColor_seq($client, $inGame="", $server=Server)
    $selectColor_req($client)
    $selectColor_res_OK_notContended($client)

    !foreach $other in %splitstr($inGame, "~")
        $event_updateColor($other)
    !endfor
!endprocedure

!endsub

title Select player color
participant Alice
participant Server
participant Bob

hnote over Alice : IN_GAME
/ hnote over Bob : IN_GAME

$event_updateGameStatus(SETUP_COLOR, Alice)
$event_updateGameStatus(SETUP_COLOR, Bob)

|||

$selectColor_req(Alice)
alt
    $selectColor_res_OK_notContended(Alice)
    $event_seq_updateColor("Alice~Bob")

    opt all players have selected a color
        event_seq_newStatus_SETUP_OBJECTIVE("Alice~Bob")
    end
else color has been already chosen by someone else
    $selectColor_res_OK_contended(Alice)
    $event_updateChosenColorList(Alice)
    $event_updateChosenColorList(Bob)
else invalid color
    Alice <-- Server: KO, invalidColor()
end

@enduml
